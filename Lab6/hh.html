<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Новости Dashboard</title>
</head>
<body>
    <h1>Новости</h1>
    <div id="news-container">
        <!-- Новости будут отображаться здесь -->
    </div>

    <script>
        const ws = new WebSocket("ws://localhost:9742/ws");
        const newsContainer = document.getElementById("news-container");

        ws.onmessage = function(event) {
            const news = JSON.parse(event.data);
            const newsItem = document.createElement("div");
            newsItem.className = "news-item";
            newsItem.innerHTML = `
                <h2><a href="${news.link}" target="_blank">${news.title}</a></h2>
                <p>${news.description}</p>
                <small>${news.pub_date}</small>
                <hr>
            `;
            // Добавляем новость в начало списка
            newsContainer.prepend(newsItem);
        };

        // Функция для загрузки существующих новостей при загрузке страницы
        function loadExistingNews() {
            fetch('/existing-news')
                .then(response => response.json())
                .then(data => {
                    data.forEach(news => {
                        const newsItem = document.createElement("div");
                        newsItem.className = "news-item";
                        newsItem.innerHTML = `
                            <h2><a href="${news.link}" target="_blank">${news.title}</a></h2>
                            <p>${news.description}</p>
                            <small>${news.pub_date}</small>
                            <hr>
                        `;
                        newsContainer.appendChild(newsItem);
                    });
                })
                .catch(error => console.error('Ошибка загрузки существующих новостей:', error));
        }

        // Загрузка существующих новостей при старте
        loadExistingNews();

        // Обновление каждые 2 секунды
        setInterval(loadExistingNews, 2000);
    </script>
</body>
</html>
