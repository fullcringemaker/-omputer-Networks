<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Дэшборд Новостей</title>
    <script>
        let socket;

        function connectWebSocket() {
            socket = new WebSocket("ws://localhost:9742/ws");

            socket.onopen = function() {
                console.log("WebSocket подключен");
            };

            socket.onmessage = function(event) {
                const news = JSON.parse(event.data);
                const newsContainer = document.getElementById("news-container");
                newsContainer.innerHTML = ""; // Очистка контейнера

                news.forEach(function(item) {
                    const newsItem = document.createElement("div");
                    newsItem.className = "news-item";

                    const title = document.createElement("h2");
                    const link = document.createElement("a");
                    link.href = item.link;
                    link.target = "_blank";
                    link.textContent = item.title;
                    title.appendChild(link);

                    const description = document.createElement("p");
                    description.textContent = item.description;

                    const pubDate = document.createElement("small");
                    pubDate.textContent = item.pub_date;

                    const hr = document.createElement("hr");

                    newsItem.appendChild(title);
                    newsItem.appendChild(description);
                    newsItem.appendChild(pubDate);
                    newsItem.appendChild(hr);

                    newsContainer.appendChild(newsItem);
                });
            };

            socket.onclose = function() {
                console.log("WebSocket отключен. Попытка переподключения через 2 секунды...");
                setTimeout(connectWebSocket, 2000);
            };

            socket.onerror = function(err) {
                console.error("WebSocket ошибка:", err);
                socket.close();
            };
        }

        window.onload = function() {
            connectWebSocket();
        };
    </script>
</head>
<body>
    <h1>Новости</h1>
    <div id="news-container">
        <!-- Новости будут отображаться здесь -->
    </div>
</body>
</html>
