<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>P2P Message Monitor</title>
</head>
<body>
    <h1>P2P Message Monitor</h1>
    <div id="peers">
        <!-- Список пиров будет динамически добавлен здесь -->
    </div>

    <script>
        // Список всех пиров
        const allPeers = [
            {name: "Peer1", address: "185.104.251.226:9765"},
            {name: "Peer2", address: "185.102.139.161:9765"},
            {name: "Peer3", address: "185.102.139.168:9765"},
            {name: "Peer4", address: "185.102.139.169:9765"}
        ];

        // Инициализация интерфейса
        function init() {
            const peersDiv = document.getElementById('peers');
            allPeers.forEach(peer => {
                const peerDiv = document.createElement('div');
                peerDiv.id = peer.name;
                peerDiv.innerHTML = `<h2>${peer.name} (${peer.address})</h2><ul id="${peer.name}-messages"></ul>`;
                peersDiv.appendChild(peerDiv);
            });

            // Установка WebSocket соединения
            const wsProtocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
            const ws = new WebSocket(wsProtocol + window.location.host + '/ws');

            ws.onopen = function() {
                console.log('WebSocket connection established');
            };

            ws.onmessage = function(event) {
                const msg = JSON.parse(event.data);
                const peerId = allPeers.find(peer => `${peer.name} (${peer.address})` === msg.destination);
                if (peerId) {
                    const msgList = document.getElementById(`${peerId.name}-messages`);
                    const listItem = document.createElement('li');
                    listItem.textContent = `From: ${msg.sender}; Content: ${msg.content}`;
                    msgList.appendChild(listItem);
                }
            };

            ws.onclose = function() {
                console.log('WebSocket connection closed');
            };

            ws.onerror = function(error) {
                console.log('WebSocket error:', error);
            };
        }

        window.onload = init;
    </script>
</body>
</html>
