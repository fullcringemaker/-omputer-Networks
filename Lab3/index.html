<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Одноранговая Сетевая Служба - Сообщения</title>
</head>
<body>
    <h1>Одноранговая Сетевая Служба - Сообщения</h1>
    <div id="peers">
        <!-- Секции для каждого пира будут добавлены здесь -->
    </div>

    <script>
        // Список всех пиров с их WebSocket URL
        const peers = [
            { name: "Peer1", wsUrl: "ws://185.104.251.226:9651/ws" },
            { name: "Peer2", wsUrl: "ws://185.102.139.161:9651/ws" },
            { name: "Peer3", wsUrl: "ws://185.102.139.169:9651/ws" },
            { name: "Peer4", wsUrl: "ws://185.102.139.168:9651/ws" }
        ];

        const peersDiv = document.getElementById('peers');

        // Создание секций для каждого пира
        peers.forEach(peer => {
            const peerSection = document.createElement('div');
            peerSection.id = `peer-${peer.name}`;
            peerSection.style.border = "1px solid black";
            peerSection.style.padding = "10px";
            peerSection.style.margin = "10px";

            const peerHeader = document.createElement('h2');
            peerHeader.textContent = `${peer.name} (${peer.wsUrl})`;
            peerSection.appendChild(peerHeader);

            const messagesList = document.createElement('ul');
            messagesList.id = `messages-${peer.name}`;
            peerSection.appendChild(messagesList);

            peersDiv.appendChild(peerSection);

            // Подключение к WebSocket
            const ws = new WebSocket(peer.wsUrl);

            ws.onopen = () => {
                console.log(`Connected to ${peer.name}`);
            };

            ws.onmessage = (event) => {
                try {
                    const msg = JSON.parse(event.data);
                    if (msg.recipient === peer.name) {
                        const li = document.createElement('li');
                        li.textContent = `From ${msg.sender}: ${msg.content}`;
                        messagesList.appendChild(li);
                    }
                } catch (e) {
                    console.error("Failed to parse message:", e);
                }
            };

            ws.onerror = (error) => {
                console.error(`WebSocket error for ${peer.name}:`, error);
            };

            ws.onclose = () => {
                console.log(`WebSocket closed for ${peer.name}`);
            };
        });
    </script>
</body>
</html>
