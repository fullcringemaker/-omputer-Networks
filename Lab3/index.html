<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Пиринговая Почтовая Служба</title>
</head>
<body>
    <h1>Пиринговая Почтовая Служба</h1>
    <h2>Список Пиров:</h2>
    <ul id="peerList">
        <li>Peer1 - 185.104.251.226:9765
            <ul id="Peer1"></ul>
        </li>
        <li>Peer2 - 185.102.139.161:9765
            <ul id="Peer2"></ul>
        </li>
        <li>Peer3 - 185.102.139.168:9765
            <ul id="Peer3"></ul>
        </li>
        <li>Peer4 - 185.102.139.169:9765
            <ul id="Peer4"></ul>
        </li>
    </ul>

    <script>
        const ws = new WebSocket(`ws://${window.location.host}/ws`);

        ws.onopen = function() {
            console.log("WebSocket connection established.");
        };

        ws.onmessage = function(event) {
            const msg = JSON.parse(event.data);
            const recipient = msg.Recipients.find(r => r === `<?php echo $peerName; ?>`) || msg.Recipients[0];
            addMessage(msg, recipient);
        };

        ws.onclose = function() {
            console.log("WebSocket connection closed.");
        };

        function addMessage(msg, recipient) {
            const recipientList = document.getElementById(recipient);
            if (recipientList) {
                const li = document.createElement("li");
                const date = new Date(msg.Timestamp * 1000);
                li.textContent = `From: ${msg.Sender} - ${msg.Content} (${date.toLocaleString()})`;
                recipientList.appendChild(li);
            }
        }
    </script>
</body>
</html>
